<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Correcting the Coverage of Credible Sets • corrcoverage</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Correcting the Coverage of Credible Sets">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">corrcoverage</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a01_gwas_to_cs.html">GWAS to Credible Set</a>
    </li>
    <li>
      <a href="../articles/corrected-coverage.html">Corrected Coverage</a>
    </li>
    <li>
      <a href="../articles/New-Credible-Set.html">New Credible Set</a>
    </li>
    <li>
      <a href="../articles/Useful-Info.html">Additional Useful Functions</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/annahutch/corrcoverage">
    <span class=" github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Correcting the Coverage of Credible Sets</h1>
                        <h4 class="author">Anna Hutchinson</h4>
            
            <h4 class="date">2019-10-19</h4>
      
      
      <div class="hidden name"><code>corrected-coverage.Rmd</code></div>

    </div>

    
    
<hr>
<p>This guide will show users how the <code>corrcoverage</code> package can be used for statistical single causal variant fine-mapping, including obtaining an accurate coverage estimate for the causal variant in a credible set (corrected coverage estimate). This package is specific to credible sets obtained using the Bayesian approach to fine-mapping, described by Maller et al. <a href="https://www.ncbi.nlm.nih.gov/pubmed/23104008">here</a>, which utilities approximate Bayes factors for genetic association studies described by Wakefield <a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/gepi.20359">here</a>.</p>
<p>The <code>corrcoverage</code> R package requires only GWAS summary statistics to provide users with a corrected coverage estimate that the true causal variant is contained within the credible set, for example calculating that a 90% credible set actually has 99% probability of containing the true causal variant. In this vignette, we walk-through how the <code>corrcoverage</code> R package can be used to perform single causal variant Bayesian fine-mapping and to derive a corrected coverage estimate.</p>
<hr>
<p>Firstly, load the library.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(corrcoverage)</a></code></pre></div>
<hr>
<div id="simulate-gwas-summary-statistics" class="section level3">
<h3 class="hasAnchor">
<a href="#simulate-gwas-summary-statistics" class="anchor"></a>1. Simulate GWAS summary statistics</h3>
<hr>
<p><strong>This package is intended for use on summary statistics obtained from GWAS, such as observed <span class="math inline">\(Z\)</span>-scores. For the purpose of this vignette, we will simulate artificial haplotypes and GWAS data using the <a href="https://github.com/chr1swallace/simGWAS">simGWAS</a> package. Please refer to the walkthrough guide <a href="https://chr1swallace.github.io/simGWAS/articles/intro.html">here</a> from which the following is taken.</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(simGWAS)</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># simulate reference haplotypes</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">nsnps &lt;-<span class="st"> </span><span class="dv">200</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">nhaps &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">lag &lt;-<span class="st"> </span><span class="dv">6</span> <span class="co"># genotypes are correlated between neighbouring variants</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">maf &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(nsnps<span class="op">+</span>lag,<span class="fl">0.05</span>,<span class="fl">0.5</span>) <span class="co"># common SNPs</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">laghaps &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="st">"cbind"</span>, <span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(maf, <span class="cf">function</span>(f) <span class="kw"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(nhaps,<span class="dv">1</span>,f)))</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">haps &lt;-<span class="st"> </span>laghaps[,<span class="dv">1</span><span class="op">:</span>nsnps]</a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>lag) </a>
<a class="sourceLine" id="cb3-11" data-line-number="11">    haps &lt;-<span class="st"> </span>haps <span class="op">+</span><span class="st"> </span>laghaps[,(<span class="dv">1</span><span class="op">:</span>nsnps)<span class="op">+</span>j]</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">haps &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(haps<span class="op">/</span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(haps,<span class="dv">2</span>,max),nhaps,nsnps,<span class="dt">byrow=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">snps &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(haps) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"s"</span>,<span class="dv">1</span><span class="op">:</span>nsnps)</a>
<a class="sourceLine" id="cb3-14" data-line-number="14">freq &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(haps<span class="op">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">freq<span class="op">$</span>Probability &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(freq)</a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(freq<span class="op">$</span>Probability)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">MAF &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span>(freq[,snps]<span class="op">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co"># SNP correlation matrix</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">LD &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cor2.html">cor2</a></span>(haps)</a></code></pre></div>
<p>We specify the causal variant (CV) and it’s effect on disease, as an odds ratio. One causal variant is chosen since the Bayesian approach to fine-mapping relies on the assumption of one causal variant per region, which has been typed in the study.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">CV &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(snps[<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span>(haps)<span class="op">&gt;</span><span class="fl">0.1</span>)],<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">iCV &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">sub</a></span>(<span class="st">"s"</span>, <span class="st">""</span>, CV) <span class="co"># index of cv</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">OR &lt;-<span class="st"> </span><span class="fl">1.1</span></a></code></pre></div>
<p>Then, we simulate marginal <span class="math inline">\(Z\)</span>-scores. Here, we consider a (relatively small) GWAS with 5000 cases and 5000 controls.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">z0 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/simGWAS/man/simulated_z_score.html">simulated_z_score</a></span>(<span class="dt">N0=</span><span class="dv">5000</span>, <span class="co"># number of controls</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">              <span class="dt">N1=</span><span class="dv">5000</span>, <span class="co"># number of cases</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">              <span class="dt">snps=</span>snps, <span class="co"># column names in freq of SNPs</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">              <span class="dt">W=</span>CV, <span class="co"># causal variants, subset of snps</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">              <span class="dt">gamma.W=</span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(OR), <span class="co"># log odds ratios</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">              <span class="dt">freq=</span>freq <span class="co"># reference haplotypes</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7">              )</a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(z0)</a></code></pre></div>
<pre><code>## [1] 200</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">z0[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a></code></pre></div>
<pre><code>## [1] -1.889831 -2.534196 -3.139531 -3.753833 -1.821278</code></pre>
<p><code>z0</code> is a vector of marginal Z scores for the SNPs in our genomic region.</p>
<hr>
</div>
<div id="convert-z-scores-to-posterior-probabilities" class="section level3">
<h3 class="hasAnchor">
<a href="#convert-z-scores-to-posterior-probabilities" class="anchor"></a>2. Convert Z scores to posterior probabilities</h3>
<hr>
<p>The <code>ppfunc</code> function is used to convert the marginal <span class="math inline">\(Z\)</span>-scores to posterior probabilities of causality. The <code>ppfunc</code> function also requires a value for <span class="math inline">\(V\)</span>, the variance of the estimated effect size, which can be calculated using the <code>Var.data.cc</code> function. The prior standard deviation of the effect size, <span class="math inline">\(W\)</span>, is an optional parameter with a default value of 0.2, which is shown to be a robust choice through our analyses.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">N0 &lt;-<span class="st"> </span><span class="dv">5000</span> <span class="co"># number of controls</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">N1 &lt;-<span class="st"> </span><span class="dv">5000</span> <span class="co"># number of cases</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">varbeta &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Var.data.cc.html">Var.data.cc</a></span>(<span class="dt">f =</span> MAF, <span class="dt">N =</span> N1<span class="op">+</span>N0, <span class="dt">s =</span> N1<span class="op">/</span>(N0<span class="op">+</span>N1)) <span class="co"># variance of </span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">                                                         <span class="co"># estimated effect size</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">postprobs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ppfunc.html">ppfunc</a></span>(<span class="dt">z =</span> z0, <span class="dt">V =</span> varbeta)</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(postprobs, <span class="dt">xlab =</span> <span class="st">"SNP index"</span>, <span class="dt">ylab =</span> <span class="st">"Posterior probability"</span>)</a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="kw"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="dt">v =</span> iCV, <span class="dt">col =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="corrected-coverage_files/figure-html/unnamed-chunk-6-1.png" width="384"></p>
<p>The posterior probability plot shows the location of the causal variant (red line).</p>
<hr>
</div>
<div id="derive-credible-set" class="section level3">
<h3 class="hasAnchor">
<a href="#derive-credible-set" class="anchor"></a>3. Derive credible set</h3>
<hr>
<p>The <code>credset</code> function in the <code>corrcoverage</code> package is used to obtain a 90% credible set using the Bayesian approach for fine-mapping. In brief, the function follows the standard steps from Maller et al.’s approach:</p>
<ol style="list-style-type: decimal">
<li>Order variants into descending order of posterior probabilities (PPs).</li>
<li>Cumulatively sum the PPs for these variants until the specified threshold (90%) is exceeded.</li>
<li>Group these variants to form the credible set.</li>
</ol>
<p>The <code>credset</code> function reports the variants in the credible set, the claimed coverage<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> (the sum of the posterior probabilities of the variants in the set) and the number of variants in the credible set (nvar). If the <code>CV</code> parameter is supplied by the user (e.g. in simulation studies where the CV is known), then the output also includes a binary indicator of whether the causal variant was contained in the credible set.</p>
<p>Let’s use the <code>credset</code> function to obtain a 90% credible set.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">thresh &lt;-<span class="st"> </span><span class="fl">0.9</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"></a>
<a class="sourceLine" id="cb12-3" data-line-number="3">credibleset &lt;-<span class="st"> </span><span class="kw"><a href="../reference/credset.html">credset</a></span>(<span class="dt">pp =</span> postprobs, <span class="dt">thr =</span> thresh)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">credibleset</a></code></pre></div>
<pre><code>## $credset
##  [1]   4 160  24   3 158  25 156 157 128  69 127   2  53  42 124 162 126
## [18] 152  51 123 171  52 145
## 
## $claimed.cov
## [1] 0.9007093
## 
## $nvar
## [1] 23</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># is the true CV contained within the credible set?</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"></a>
<a class="sourceLine" id="cb14-3" data-line-number="3">thresh &lt;-<span class="st"> </span><span class="fl">0.9</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">credibleset &lt;-<span class="st"> </span><span class="kw"><a href="../reference/credset.html">credset</a></span>(<span class="dt">pp =</span> postprobs, <span class="dt">CV =</span> iCV, <span class="dt">thr =</span> thresh)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6"></a>
<a class="sourceLine" id="cb14-7" data-line-number="7">credibleset</a></code></pre></div>
<pre><code>## $credset
##  [1]   4 160  24   3 158  25 156 157 128  69 127   2  53  42 124 162 126
## [18] 152  51 123 171  52 145
## 
## $claimed.cov
## [1] 0.9007093
## 
## $covered
## [1] 1
## 
## $nvar
## [1] 23</code></pre>
<p>The 90% credible set has a claimed coverage of ~90% and contains the true causal variant. In the literature, authors would typically report that they have found a 90% credible set which they are at least 90% confident contains the true causal variant.</p>
<p>Note that if the variants are named in the <code>pp</code> vector, then the <code>$credset</code> output would contain variant names rather than their indices.</p>
<hr>
</div>
<div id="obtain-corrected-coverage-estimate" class="section level3">
<h3 class="hasAnchor">
<a href="#obtain-corrected-coverage-estimate" class="anchor"></a>4. Obtain corrected coverage estimate</h3>
<hr>
<p>Suppose we are suspicious of this coverage estimate (90% in our example) and wish to find a more accurate estimate using this fancy new package. The <code>corrcov</code> function can be used, which requires the following parameters to be specified:</p>
<ul>
<li>
<code>z</code> (vector of marginal <span class="math inline">\(Z\)</span>-scores)</li>
<li>
<code>f</code> (vector of minor allele frequencies)</li>
<li>
<code>N0</code>, <code>N1</code> (number of controls and cases respectively)</li>
<li>
<code>Sigma</code> (SNP correlation matrix)</li>
<li>
<code>thr</code> (threshold used to derive the credible set)</li>
</ul>
<p><strong>Note that if the estimated effect size coefficients (<code>bhat</code>) and their standard errors (<code><a href="https://rdrr.io/r/base/MathFun.html">sqrt(V)</a></code>) are known instead of <span class="math inline">\(Z\)</span>-scores and minor allele frequencies, then the <code>corrcov_bhat</code> function can be used analogously.</strong></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">corrected_cov_estimate &lt;-<span class="st"> </span><span class="kw"><a href="../reference/corrcov.html">corrcov</a></span>(<span class="dt">z =</span> z0, <span class="dt">f =</span> MAF, N0, N1, <span class="dt">Sigma =</span> LD, <span class="dt">thr =</span> thresh)</a></code></pre></div>
<pre><code>##  Corrected.Coverage Claimed.Coverage Threshold
##           0.9832236        0.9007093       0.9</code></pre>
<p>In our example, the 90% credible set may have nearer to 98% coverage of the causal variant in the credible set.</p>
<hr>
</div>
<div id="evaluate-accuracy-of-estimate" class="section level3">
<h3 class="hasAnchor">
<a href="#evaluate-accuracy-of-estimate" class="anchor"></a>5. Evaluate accuracy of estimate</h3>
<hr>
<p>For the purpose of this vignette and to assess the accuracy of this corrected coverage estimate, we simulate more credible sets from the same system and calculate what proportion of these contain the true causal variant.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">z0.tmp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/simGWAS/man/simulated_z_score.html">simulated_z_score</a></span>(<span class="dt">N0=</span><span class="dv">5000</span>, <span class="co"># number of controls</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">                            <span class="dt">N1=</span><span class="dv">5000</span>, <span class="co"># number of cases</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3">                            <span class="dt">snps=</span>snps, <span class="co"># column names in freq</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4">                            <span class="dt">W=</span>CV, <span class="co"># causal variants, subset of snps</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5">                            <span class="dt">gamma.W=</span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(OR), <span class="co"># log odds ratios</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6">                            <span class="dt">freq=</span>freq, <span class="co"># reference haplotypes</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7">                            <span class="dt">nrep =</span> <span class="dv">5000</span> <span class="co"># 5000 simulations</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb18-9" data-line-number="9"></a>
<a class="sourceLine" id="cb18-10" data-line-number="10">pps &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ppfunc.mat.html">ppfunc.mat</a></span>(<span class="dt">zstar =</span> z0.tmp, <span class="dt">V =</span> varbeta) <span class="co"># find pps</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11">cs &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(pps, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="kw"><a href="../reference/credset.html">credset</a></span>(x, <span class="dt">CV =</span> iCV, <span class="dt">thr =</span> thresh)<span class="op">$</span>cov)</a>
<a class="sourceLine" id="cb18-12" data-line-number="12">true.cov.est &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(cs)</a>
<a class="sourceLine" id="cb18-13" data-line-number="13">true.cov.est</a></code></pre></div>
<pre><code>## [1] 0.981</code></pre>
<p>The estimated empirical coverage is found to be approximately 98%, showing that our corrected coverage estimate was indeed accurate - far more so than the standard claimed coverage of ~90%.</p>
<pre><code>##  Empirical.Coverage Corrected.Coverage Claimed.Coverage Threshold
##               0.981          0.9832236        0.9007093       0.9</code></pre>
<hr>
</div>
<div id="so-what" class="section level3">
<h3 class="hasAnchor">
<a href="#so-what" class="anchor"></a>So what?</h3>
<p>This vignette has shown readers how to use the <code>corrcoverage</code> R package to obtain a more accurate coverage estimate of the causal variant in a credible set. Obtaining accurate coverage estimates will allow researchers to report more specific findings from their fine-mapping analysis, and we hope that our correction will be used as an extra step in the single causal variant fine-mapping pipeline. Finally, reporting these corrected coverage estimates will allow for more efficient allocation and expenditure of resources in the laborious follow-up wet lab analyses of the variants in the credible set.</p>
<p>This method can be extended to find a corrected credible set, please see <a href="https://annahutch.github.io/corrcoverage/articles/New-Credible-Set.html" class="uri">https://annahutch.github.io/corrcoverage/articles/New-Credible-Set.html</a>.</p>
<hr>
</div>
<div id="references" class="section level3">
<h3 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h3>
<p><a href="https://www.ncbi.nlm.nih.gov/pubmed/23104008">Maller et al., 2013</a> Maller, J. B. et al. Bayesian refinement of association signals for 14 loci in 3 common diseases. Nature Genet. 44, 1294–1301 (2012)</p>
<p><a href="https://github.com/chr1swallace/simGWAS">simGWAS</a>: Mary D Fortune, Chris Wallace; simGWAS: a fast method for simulation of large scale case–control GWAS summary statistics, Bioinformatics, bty898 (2018)</p>
<p><a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/gepi.20359">Wakefield, 2009</a> Wakefield, J. Bayes factors for genome-wide association studies: comparison with P-values. Genet. Epidemiol. 33, 79–86 (2009)</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Researchers commonly use the size of the credible set as an estimate of the coverage probability of the causal variant in the set. It is believed to be a slightly better indicator of coverage than the threshold (claimed coverage &gt; threshold by virtue of the method).<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Anna Hutchinson, Chris Wallace.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
